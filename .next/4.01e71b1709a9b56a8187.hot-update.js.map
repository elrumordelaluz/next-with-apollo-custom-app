{"version":3,"file":"4.01e71b1709a9b56a8187.hot-update.js","sources":["webpack:///lib/withData.js"],"sourcesContent":["import React from 'react'\nimport PropTypes from 'prop-types'\nimport { ApolloProvider, getDataFromTree } from 'react-apollo'\nimport Head from 'next/head'\nimport initApollo from './initApollo'\n\n// Gets the display name of a JSX component for dev tools\nfunction getComponentDisplayName(Component) {\n  return Component.displayName || Component.name || 'Unknown'\n}\n\nexport default ComposedComponent => {\n  return class WithData extends React.Component {\n    static displayName = `WithData(${getComponentDisplayName(\n      ComposedComponent\n    )})`\n    static propTypes = {\n      serverState: PropTypes.object.isRequired\n    }\n\n    static async getInitialProps(ctx) {\n      // Initial serverState with apollo (empty)\n      let serverState\n\n      // Evaluate the composed component's getInitialProps()\n      let composedInitialProps = {}\n      if (ComposedComponent.getInitialProps) {\n        composedInitialProps = await ComposedComponent.getInitialProps(ctx)\n      }\n\n      // Run all GraphQL queries in the component tree\n      // and extract the resulting data\n      const apollo = initApollo()\n      try {\n        // create the url prop which is passed to every page\n        const url = {\n          query: ctx.query,\n          asPath: ctx.asPath,\n          pathname: ctx.pathname,\n        };\n\n        // Run all GraphQL queries\n        await getDataFromTree(\n          <ComposedComponent ctx={ctx} url={url} {...composedInitialProps} />,\n          {\n            router: {\n              asPath: ctx.asPath,\n              pathname: ctx.pathname,\n              query: ctx.query\n            },\n            client: apollo\n          }\n        )\n      } catch (error) {\n        // Prevent Apollo Client GraphQL errors from crashing SSR.\n        // Handle them in components via the data.error prop:\n        // http://dev.apollodata.com/react/api-queries.html#graphql-query-data-error\n      }\n\n      if (!process.browser) {\n        // getDataFromTree does not call componentWillUnmount\n        // head side effect therefore need to be cleared manually\n        Head.rewind()\n      }\n\n      // Extract query data from the Apollo store\n      serverState = {\n        apollo: {\n          data: apollo.cache.extract()\n        }\n      }\n\n      return {\n        serverState,\n        ...composedInitialProps\n      }\n    }\n\n    constructor(props) {\n      super(props)\n      this.apollo = initApollo(this.props.serverState.apollo.data)\n    }\n\n    render() {\n      return (\n        <ApolloProvider client={this.apollo}>\n          <ComposedComponent {...this.props} />\n        </ApolloProvider>\n      )\n    }\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// lib/withData.js"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AACA;AADA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AASA;AAGA;AACA;AACA;AAdA;AAAA;AAAA;AAAA;AACA;AADA;AAAA;AACA;AADA;AAeA;AACA;AAhBA;AAkBA;AACA;AACA;AApBA;AAsBA;AACA;AACA;AACA;AACA;AAHA;AACA;AAxBA;AAAA;AA+BA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAEA;AACA;AACA;AACA;AAHA;AAKA;AANA;AACA;AAjCA;AAAA;AAAA;AACA;AADA;AAAA;AAAA;AACA;AADA;AA+CA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AADA;AADA;AAtDA;AA6DA;AA7DA;AACA;AADA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AADA;AAAA;AAAA;AAAA;AAAA;AACA;AAiEA;AAAA;AACA;AADA;AACA;AAAA;AACA;AAFA;AAGA;AACA;AAtEA;AAAA;AAAA;AAwEA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAGA;AA7EA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AADA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAKA;AADA;AAJA;AA+EA;AACA;AAjFA;;;;;;;;;;;;AAJA;;;;;;;;;;A","sourceRoot":""}